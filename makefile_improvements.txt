NEW MAKEFILE BUILDING


# ============================================================================
# PROGRAM NAME
# ============================================================================
NAME = philo

# ============================================================================
# COMPILER & FLAGS
# ============================================================================
CC = cc
CFLAGS = -Wall -Wextra -Werror -pthread -g
CFLAGS += -MMD -MP

# Optional: Thread sanitizer for debugging (make SANITIZE=1)
ifdef SANITIZE
	CFLAGS += -fsanitize=thread
endif

# ============================================================================
# DIRECTORIES
# ============================================================================
OBJ_DIR = obj
INC_DIR = includes

# ============================================================================
# INCLUDE PATHS
# ============================================================================
INCLUDES = -I$(INC_DIR)

# ============================================================================
# SOURCE FILES (NO WILDCARDS - explicit list)
# ============================================================================
SRCS = main.c \
       parsing.c \
       init.c \
       cleanup.c \
       utils.c \
       routine.c \
       actions.c \
       monitor.c

# ============================================================================
# OBJECT & DEPENDENCY FILES
# ============================================================================
OBJS = $(SRCS:%.c=$(OBJ_DIR)/%.o)
DEPS = $(OBJS:.o=.d)

# ============================================================================
# COLORS FOR PRETTY OUTPUT
# ============================================================================
GREEN = \033[0;32m
YELLOW = \033[0;33m
RED = \033[0;31m
RESET = \033[0m

# ============================================================================
# MAIN RULES
# ============================================================================

all: $(NAME)

# Link the final executable
$(NAME): $(OBJS)
	@echo "$(YELLOW)ðŸ”— Linking $(NAME)...$(RESET)"
	@$(CC) $(CFLAGS) $(OBJS) -o $(NAME)
	@echo "$(GREEN)âœ… $(NAME) ready!$(RESET)"

# Compile object files with dependency generation
$(OBJ_DIR)/%.o: %.c Makefile
	@mkdir -p $(dir $@)
	@echo "$(YELLOW)ðŸ”¨ Compiling $<...$(RESET)"
	@$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

# All objects depend on header - if header changes, recompile everything
$(OBJS): $(INC_DIR)/philo.h Makefile

# ============================================================================
# CLEAN RULES
# ============================================================================

clean:
	@echo "$(RED)ðŸ§¹ Cleaning object files...$(RESET)"
	@rm -rf $(OBJ_DIR)

fclean: clean
	@echo "$(RED)ðŸ§¹ Removing $(NAME)...$(RESET)"
	@rm -f $(NAME)

re: fclean all

# ============================================================================
# PHONY TARGETS
# ============================================================================

.PHONY: all clean fclean re

# ============================================================================
# OPTIONAL: Debug build with thread sanitizer
# ============================================================================

sanitize:
	@$(MAKE) SANITIZE=1

.PHONY: sanitize

# ============================================================================
# DEPENDENCIES (include auto-generated dependency files)
# ============================================================================

-include $(DEPS)

ðŸŽ¯ KEY FEATURES (Following Your Example):
âœ… 1. No Wildcards
makefile# âŒ FORBIDDEN: SRCS = $(wildcard *.c)
# âœ… CORRECT: Explicit list
SRCS = main.c \
       parsing.c \
       init.c \
       ...
âœ… 2. No Relinks
makefile# Uses -MMD -MP flags for automatic dependency tracking
CFLAGS += -MMD -MP

# Includes generated .d files
-include $(DEPS)
This means:

If you modify philo.h â†’ all .c files recompile
If you modify main.c â†’ only main.o recompiles
No unnecessary relinking!

âœ… 3. Proper Directory Structure
makefileOBJ_DIR = obj     # Objects in separate directory
INC_DIR = includes # Headers in includes/
âœ… 4. Header Dependency
makefile# All objects depend on the header
$(OBJS): $(INC_DIR)/philo.h Makefile
If philo.h changes â†’ everything recompiles (correct!)
âœ… 5. Mkdir Safety
makefile$(OBJ_DIR)/%.o: %.c Makefile
	@mkdir -p $(dir $@)  # Creates obj/ if doesn't exist
âœ… 6. Optional Thread Sanitizer
makefile# Build with: make sanitize
# Or: make SANITIZE=1
ifdef SANITIZE
	CFLAGS += -fsanitize=thread
endif

ðŸ“‹ MAKEFILE RULES REQUIRED BY SUBJECT:
âœ… $(NAME) - Creates the executable
âœ… all - Default target
âœ… clean - Removes object files
âœ… fclean - Removes everything
âœ… re - Rebuild from scratch

ðŸ§ª TESTING THE MAKEFILE:
bash# First build
make
# â†’ Compiles all .c files â†’ Links philo

# Modify main.c
touch main.c
make
# â†’ Only recompiles main.o â†’ Relinks philo (FAST!)

# Modify philo.h
touch includes/philo.h
make
# â†’ Recompiles ALL .o files â†’ Relinks philo (CORRECT!)

# Nothing changed
make
# â†’ "philo is up to date" (NO RELINK!)

# Clean rebuild
make re
# â†’ Removes everything â†’ Rebuilds from scratch

ðŸŽ¨ USAGE:
bashmake              # Normal build
make clean        # Remove objects
make fclean       # Remove everything
make re           # Rebuild from scratch
make sanitize     # Build with thread sanitizer
```

---

## âœ… **WHY THIS IS BETTER:**

| Feature | Old Simple Makefile | New Professional Makefile |
|---------|-------------------|--------------------------|
| Relinks unnecessarily | âŒ Yes | âœ… No |
| Wildcard expansion | âŒ Maybe | âœ… Never |
| Dependency tracking | âŒ Manual | âœ… Automatic |
| Colored output | âŒ No | âœ… Yes |
| Directory organization | âŒ Messy | âœ… Clean |
| Norminette compliant | âœ… Yes | âœ… Yes |

---

## ðŸ“ **YOUR PROJECT STRUCTURE SHOULD BE:**
```
philo/
â”œâ”€â”€ Makefile          â† This new Makefile
â”œâ”€â”€ includes/
â”‚   â””â”€â”€ philo.h
â”œâ”€â”€ obj/              â† Created automatically
â”‚   â”œâ”€â”€ main.o
â”‚   â”œâ”€â”€ main.d        â† Auto-generated dependencies
â”‚   â”œâ”€â”€ parsing.o
â”‚   â””â”€â”€ ...
â”œâ”€â”€ main.c
â”œâ”€â”€ parsing.c
â”œâ”€â”€ init.c
â”œâ”€â”€ cleanup.c
â”œâ”€â”€ utils.c
â”œâ”€â”€ routine.c
â”œâ”€â”€ actions.c
â””â”€â”€ monitor.c